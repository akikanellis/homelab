---
- name: Setup ZSH
  ansible.builtin.import_role:
    name: gantsign.antigen
  vars:
    users:
      - username: aki
        antigen_libraries:
          - name: oh-my-zsh
        antigen_theme:
          name: robbyrussell
        antigen_bundles:
          - name: asdf
          - name: git

- name: Create "aki" user config directories
  ansible.builtin.file:
    path: /home/aki/{{ item }}
    state: directory
    owner: aki
    group: aki
    mode: 0700
  loop:
    - .config
    - .config/bat
    - .zsh

- name: Copy "aki" user ZSH configs
  ansible.builtin.template:
    src: users/aki/zsh/{{ item.name }}.zsh.j2
    dest: /home/aki/.zsh/{{ item.name }}.zsh
    owner: aki
    group: aki
    mode: "{{ item.mode | default('0600') }}"
  loop:
    - name: env
    - name: fuck
    - {name: lessfilter, mode: "0700"}
    - name: path
    - name: starship
    - name: zoxide

- name: Copy "aki" user zshenv
  ansible.builtin.template:
    src: users/aki/zsh/zshenv.j2
    dest: /home/aki/.zshenv
    owner: aki
    group: aki
    mode: 0600

- name: Copy "aki" user zshrc
  ansible.builtin.template:
    src: users/aki/zsh/zshrc.j2
    dest: /home/aki/.zshrc
    owner: aki
    group: aki
    # This needs to match the mode set by gantsign.antigen otherwise it will
    # keep changing on each task execution
    mode: 0644

- name: Copy "aki" user configs
  ansible.builtin.template:
    src: users/aki/{{ item.src }}.j2
    dest: /home/aki/{{ item.dest }}
    owner: aki
    group: aki
    mode: 0600
  loop:
    - {src: bat/config, dest: .config/bat/config}
